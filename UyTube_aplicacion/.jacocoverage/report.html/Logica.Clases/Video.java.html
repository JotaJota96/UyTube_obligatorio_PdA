<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Video.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;UyTube&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">Logica.Clases</a> &gt; <span class="el_source">Video.java</span></div><h1>Video.java</h1><pre class="source lang-java linenums">package Logica.Clases;
import Logica.DataType.DtComentario;
import Logica.DataType.DtValoracion;
import Logica.DataType.DtVideo;
import java.sql.Time;
import java.sql.Date;
import Logica.Enumerados.Privacidad;
import Logica.Enumerados.TipoValoracion;
import java.util.ArrayList;
import java.util.Map;
import java.util.TreeMap;

public class Video {    
    private int id;
    private String nombre;
    private String descripcion;
    private Time duracion;
    private Date fechaPublicacion;
    private String urlVideoOriginal;
<span class="pc" id="L20">    private Privacidad privacidad = Privacidad.PRIVADO;</span>
    private String categoria;
<span class="pc" id="L22">    private int cantLikes = 0;</span>
<span class="pc" id="L23">    private int cantDisLikes = 0;</span>
    private ArrayList&lt;Valoracion&gt; valoraciones;
    private Map&lt;Integer, Comentario&gt; comentarios;
<span class="fc" id="L26">    private static int idActual = 1;</span>
    
<span class="fc" id="L28">    public Video(){</span>
        
<span class="fc" id="L30">    }</span>
    /********************** Constructor *********************/
<span class="nc" id="L32">    public Video(int _id, String _nombre, String _descripcion,Time _duracion, Date _fechaPublicacion,String _urlVideoOriginal,String _categoria ){</span>
<span class="nc bnc" id="L33" title="All 2 branches missed.">        if( _id &lt; 0){ throw new RuntimeException(&quot;Error, el id del video es un negativo o cero.&quot;); }</span>
<span class="nc bnc" id="L34" title="All 2 branches missed.">        if( _nombre == &quot;&quot;){ throw new RuntimeException(&quot;Error, el nombre del video está vacío&quot;);}</span>
<span class="nc bnc" id="L35" title="All 2 branches missed.">        if( _duracion == null){ throw new RuntimeException(&quot;Error, la duración del video es null.&quot;);}</span>
<span class="nc bnc" id="L36" title="All 2 branches missed.">        if( _fechaPublicacion == null){ throw new RuntimeException(&quot;Error, la fecha de publicación del video es null.&quot;);}</span>
<span class="nc bnc" id="L37" title="All 2 branches missed.">        if( _urlVideoOriginal == &quot;&quot;){ throw new RuntimeException(&quot;Error, la url del video está vacía.&quot;);}</span>
<span class="nc bnc" id="L38" title="All 2 branches missed.">        if( _categoria == &quot;&quot; ){ throw new RuntimeException(&quot;Error, la descripción del video está vacía.&quot;);}</span>
<span class="nc" id="L39">        this.id = _id;</span>
<span class="nc" id="L40">        this.nombre = _nombre;</span>
<span class="nc" id="L41">        this.descripcion = _descripcion;</span>
<span class="nc" id="L42">        this.duracion = _duracion;</span>
<span class="nc" id="L43">        this.fechaPublicacion = _fechaPublicacion;</span>
<span class="nc" id="L44">        this.urlVideoOriginal = _urlVideoOriginal;    </span>
<span class="nc" id="L45">        this.categoria = _categoria;</span>
<span class="nc" id="L46">        this.valoraciones = new ArrayList&lt;Valoracion&gt;();</span>
<span class="nc" id="L47">        this.comentarios = new TreeMap&lt;Integer, Comentario&gt;();        </span>
<span class="nc" id="L48">    }</span>
    
    /** Agregar un nuevo comentario **/
    public void agregarComentario(DtComentario dtComentario, Usuario usuario){
<span class="pc bpc" id="L52" title="1 of 2 branches missed.">        if (dtComentario == null){</span>
<span class="fc" id="L53">            throw new RuntimeException(&quot;El DataType es null&quot;);</span>
        }
<span class="nc bnc" id="L55" title="All 2 branches missed.">        if (usuario == null){</span>
<span class="nc" id="L56">            throw new RuntimeException(&quot;El usuario es null&quot;);</span>
        }
        
<span class="nc" id="L59">        int nuevoId = Comentario.getNuevoID();</span>
<span class="nc" id="L60">        Comentario nuevoComentario = new Comentario(nuevoId, dtComentario.getFecha(), dtComentario.getTexto(), 0, usuario);</span>
<span class="nc" id="L61">        comentarios.put(nuevoId, nuevoComentario);</span>
<span class="nc" id="L62">    }</span>
    
    /*  Agregar un subcomentario a un comentario existente  */
    public void agregarComentario(int idCom, DtComentario dtComentario, Usuario usuario){
<span class="pc bpc" id="L66" title="1 of 2 branches missed.">        if (dtComentario == null){</span>
<span class="fc" id="L67">            throw new RuntimeException(&quot;El DataType es null&quot;);</span>
        }
<span class="nc bnc" id="L69" title="All 2 branches missed.">        if (usuario == null){</span>
<span class="nc" id="L70">            throw new RuntimeException(&quot;El usuario es null&quot;);</span>
        }
        
<span class="nc bnc" id="L73" title="All 2 branches missed.">        for (Map.Entry&lt;Integer, Comentario&gt; coment : comentarios.entrySet()) {</span>
<span class="nc bnc" id="L74" title="All 2 branches missed.">            if(coment.getValue().agregarSubComentario(idCom, dtComentario, usuario)){</span>
<span class="nc" id="L75">                break;</span>
            }
<span class="nc" id="L77">        }</span>
<span class="nc" id="L78">    }</span>
    
    /* Agrega o midifica una valoración */
    public void agregarModificarValoracion(DtValoracion dtValoracion, Usuario usuario) {
<span class="pc bpc" id="L82" title="1 of 2 branches missed.">        if (dtValoracion == null) {</span>
<span class="fc" id="L83">            throw new RuntimeException(&quot;El DataType es null&quot;);</span>
        }
<span class="nc bnc" id="L85" title="All 2 branches missed.">        if (usuario == null){</span>
<span class="nc" id="L86">            throw new RuntimeException(&quot;El usuario es null&quot;);</span>
        }
        
<span class="nc" id="L89">        String nickname = usuario.getNickname();</span>
        // por las dudas, para que los contadores de likes no queden inconsistentes:
        // obtengo la valoracion que le habia dado antes el usuario (si es que lo habia alorado)
<span class="nc" id="L92">        DtValoracion dtv = this.obtenerValoracion(nickname);</span>
        // si el usuario ya lo valoro
<span class="nc bnc" id="L94" title="All 2 branches missed.">        if (dtv != null) {</span>
            // segun cual fuera la valoracion anterior, resta 1 al contador
<span class="nc bnc" id="L96" title="All 2 branches missed.">            if (dtv.getVal() == TipoValoracion.LIKE) {</span>
<span class="nc" id="L97">                cantLikes--;</span>
            } else {
<span class="nc" id="L99">                cantDisLikes--;</span>
            }

<span class="nc bnc" id="L102" title="All 2 branches missed.">            for (Valoracion val : valoraciones) {</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">                if (val.modificar(dtValoracion, nickname)) {</span>
<span class="nc" id="L104">                    break;</span>
                }
<span class="nc" id="L106">            }</span>
        } else {
<span class="nc" id="L108">            Valoracion nuevaValoracion = new Valoracion(dtValoracion.getVal(), usuario);</span>
<span class="nc" id="L109">            valoraciones.add(nuevaValoracion);</span>
        }

        // segun cual sea la nueva valoracion, suma 1 al contador
<span class="nc bnc" id="L113" title="All 2 branches missed.">        if (dtValoracion.getVal() == TipoValoracion.LIKE) {</span>
<span class="nc" id="L114">            cantLikes++;</span>
        } else {
<span class="nc" id="L116">            cantDisLikes++;</span>
        }

<span class="nc" id="L119">    }</span>

    public DtVideo getDt(){
<span class="fc" id="L122">        return new DtVideo(this.id, this.nombre, this.descripcion, this.duracion, this.fechaPublicacion, this.urlVideoOriginal, this.privacidad, this.categoria, this.cantLikes, this.cantDisLikes);</span>
    }
    
    public ArrayList&lt;DtComentario&gt; listarComentarios(){
<span class="fc" id="L126">        ArrayList&lt;DtComentario&gt; listaComent = new ArrayList&lt;DtComentario&gt;();</span>
        // recorro los comentarios sobre el video
<span class="nc bnc" id="L128" title="All 2 branches missed.">        for (Map.Entry&lt;Integer, Comentario&gt; coment : comentarios.entrySet()) {</span>
            // le obtengo el DT y lo agrego a la lista resultado
<span class="nc" id="L130">            listaComent.add(coment.getValue().getDT());</span>
            // agrego a la lista resultado, la lista de sub comentarios
<span class="nc" id="L132">            listaComent.addAll(coment.getValue().listarSubComentarios());</span>
<span class="nc" id="L133">        }</span>
<span class="nc" id="L134">        return listaComent;</span>
    }
   
    public ArrayList&lt;DtValoracion&gt; listarValoraciones(){
<span class="fc" id="L138">        ArrayList&lt;DtValoracion&gt; listaValoraciones = new ArrayList();</span>
        // recorre todo el array de valoraciones
<span class="pc bnc" id="L140" title="All 2 branches missed.">        for(int i = 0; i &lt; this.valoraciones.size(); i++){</span>
            // para cada elemento le pide el DT (al llamar esa funcion es que hace el new) y lo agrega a la coleccion de retorno
<span class="nc" id="L142">            listaValoraciones.add(this.valoraciones.get(i).getDT());</span>
        }
<span class="nc" id="L144">        return listaValoraciones;</span>
    }
    
    public void modificar(DtVideo dtVideo){
<span class="pc bpc" id="L148" title="1 of 2 branches missed.">        if(dtVideo == null){</span>
<span class="fc" id="L149">            throw new RuntimeException(&quot;El DtVideo es vacío&quot;);</span>
        }
        // Perdon julio pero no entendi nada xD
        
<span class="nc bnc" id="L153" title="All 2 branches missed.">        if(dtVideo.getNombre()== &quot;&quot;){</span>
<span class="nc" id="L154">            throw new RuntimeException(&quot;El nombre no puede ser vacío&quot;);</span>
        } 
        
<span class="nc bnc" id="L157" title="All 2 branches missed.">        if (dtVideo.getDuracion()== null) {</span>
<span class="nc" id="L158">            throw new RuntimeException(&quot;La duracion no puede ser vacía&quot;);</span>
        }
        
<span class="nc bnc" id="L161" title="All 2 branches missed.">        if (dtVideo.getFechaPublicacion() == null) {</span>
<span class="nc" id="L162">            throw new RuntimeException(&quot;La fecha no puede ser vacía&quot;);</span>
        }
        
<span class="nc bnc" id="L165" title="All 2 branches missed.">        if (dtVideo.getCategoria() == &quot;&quot;) {</span>
<span class="nc" id="L166">            throw new RuntimeException(&quot;La categoria no puede ser vacía&quot;);</span>
        }
        
<span class="nc" id="L169">        this.nombre = dtVideo.getNombre();</span>
<span class="nc" id="L170">        this.descripcion = dtVideo.getDescripcion();</span>
<span class="nc" id="L171">        this.duracion = dtVideo.getDuracion();</span>
<span class="nc" id="L172">        this.fechaPublicacion = dtVideo.getFechaPublicacion();</span>
<span class="nc" id="L173">        this.privacidad = dtVideo.getPrivacidad();</span>
<span class="nc" id="L174">        this.categoria = dtVideo.getCategoria();</span>
        
<span class="nc" id="L176">    }</span>
    
    /*   Obtiene la valoracion que hizo un usuario */
    public DtValoracion obtenerValoracion(String nickname) {
<span class="pc bpc" id="L180" title="1 of 2 branches missed.">        if (nickname.equals(&quot;&quot;)) {</span>
<span class="fc" id="L181">            throw new RuntimeException(&quot;El nickname no puede ser vacio&quot;);</span>
        }
<span class="nc bnc" id="L183" title="All 2 branches missed.">        for(int i = 0; i &lt; this.valoraciones.size(); i++){</span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">            if( valoraciones.get(i).getNicknameDeUsuario() == nickname){</span>
<span class="nc" id="L185">                return valoraciones.get(i).getDT();</span>
            }
        }
<span class="nc" id="L188">        return null;</span>
    }
    
    public void quitarValoracion(String nickname){
<span class="pc bpc" id="L192" title="1 of 2 branches missed.">        if (nickname.equals(&quot;&quot;)){</span>
<span class="fc" id="L193">            throw new RuntimeException(&quot;El nickname no puede ser vacio&quot;);</span>
        }
        // Recorrer todas las valoraciones hasta encontrar la valoracion cuyo usuario sea el que tiene ese nickname
        // cuando la encuentre, la saca de la coleccion

<span class="nc bnc" id="L198" title="All 2 branches missed.">        for(int i = 0; i &lt; this.valoraciones.size(); i++){</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">            if(valoraciones.get(i).getNicknameDeUsuario().equals(nickname) ){</span>

                // segun cual fuera la valoracion anterior, resta 1 al contador
<span class="nc bnc" id="L202" title="All 2 branches missed.">                if (valoraciones.get(i).getVal() == TipoValoracion.LIKE) {</span>
<span class="nc" id="L203">                    cantLikes--;</span>
                } else {
<span class="nc" id="L205">                    cantDisLikes--;</span>
                }
                
                // remueve de la coleccion
<span class="nc" id="L209">                valoraciones.remove(i);</span>
<span class="nc" id="L210">                break;</span>
            }

        }
<span class="nc" id="L214">    }</span>
    
    
    public static int getNuevoId(){
<span class="fc" id="L218">        int nuevoId = idActual ++;</span>
<span class="fc" id="L219">        return nuevoId;        </span>
    }
    
//============================  Get and Set ================================
    public int getId() {
<span class="fc" id="L224">        return id;</span>
    }

    public void setId(int id) {
<span class="fc" id="L228">        this.id = id;</span>
<span class="fc" id="L229">    }</span>

    public String getNombre() {
<span class="fc" id="L232">        return nombre;</span>
    }

    public void setNombre(String nombre) {
<span class="fc" id="L236">        this.nombre = nombre;</span>
<span class="fc" id="L237">    }</span>

    public String getDescripcion() {
<span class="fc" id="L240">        return descripcion;</span>
    }

    public void setDescripcion(String descripcion) {
<span class="fc" id="L244">        this.descripcion = descripcion;</span>
<span class="fc" id="L245">    }</span>

    public Time getDuracion() {
<span class="fc" id="L248">        return duracion;</span>
    }

    public void setDuracion(Time duracion) {
<span class="fc" id="L252">        this.duracion = duracion;</span>
<span class="fc" id="L253">    }</span>

    public Date getFechaPublicacion() {
<span class="fc" id="L256">        return fechaPublicacion;</span>
    }

    public void setFechaPublicacion(Date fechaPublicacion) {
<span class="fc" id="L260">        this.fechaPublicacion = fechaPublicacion;</span>
<span class="fc" id="L261">    }</span>

    public String getUrlVideoOriginal() {
<span class="fc" id="L264">        return urlVideoOriginal;</span>
    }

    public void setUrlVideoOriginal(String urlVideoOriginal) {
<span class="fc" id="L268">        this.urlVideoOriginal = urlVideoOriginal;</span>
<span class="fc" id="L269">    }</span>

    public Privacidad getPrivacidad() {
<span class="fc" id="L272">        return privacidad;</span>
    }

    public void setPrivacidad(Privacidad privacidad) {
<span class="fc" id="L276">        this.privacidad = privacidad;</span>
<span class="fc" id="L277">    }</span>

    public String getCategoria() {
<span class="fc" id="L280">        return categoria;</span>
    }

    public void setCategoria(String categoria) {
<span class="fc" id="L284">        this.categoria = categoria;</span>
<span class="fc" id="L285">    }</span>

    public int getCantLikes() {
<span class="fc" id="L288">        return cantLikes;</span>
    }

    public void setCantLikes(int cantLikes) {
<span class="fc" id="L292">        this.cantLikes = cantLikes;</span>
<span class="fc" id="L293">    }</span>

    public int getCantDisLikes() {
<span class="fc" id="L296">        return cantDisLikes;</span>
    }

    public void setCantDisLikes(int cantDisLikes) {
<span class="fc" id="L300">        this.cantDisLikes = cantDisLikes;</span>
<span class="fc" id="L301">    }</span>

    @Override
    public String toString() {
<span class="fc" id="L305">        return &quot;Video{&quot; + &quot;id=&quot; + id + &quot;, nombre=&quot; + nombre + &quot;, descripcion=&quot; + descripcion + &quot;, duracion=&quot; + duracion + &quot;, fechaPublicacion=&quot; + fechaPublicacion + &quot;, urlVideoOriginal=&quot; + urlVideoOriginal + &quot;, privacidad=&quot; + privacidad + &quot;, categoria=&quot; + categoria + &quot;, cantLikes=&quot; + cantLikes + &quot;, cantDisLikes=&quot; + cantDisLikes + '}';</span>
    }
    
    
    

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>